Description: fix denial of service via null pointer dereference
Origin: vendor, http://anoncvs.estpak.ee/cgi-bin/cgit/openbsd-src/commit/lib/libssl?id=e76e308f1fab2253ab5b4ef52a1865c5ffecdf21
Bug: http://rt.openssl.org/Ticket/Display.html?user=guest&pass=guest&id=3321

Index: openssl-1.0.1f/ssl/s3_pkt.c
===================================================================
--- openssl-1.0.1f.orig/ssl/s3_pkt.c	2014-05-02 15:00:28.216467809 -0400
+++ openssl-1.0.1f/ssl/s3_pkt.c	2014-05-02 15:02:06.192469397 -0400
@@ -657,6 +657,10 @@
 		if (i <= 0)
 			return(i);
 		/* if it went, fall through and send more stuff */
+		/* we may have released our buffer, so get it again */
+		if (wb->buf == NULL)
+			if (!ssl3_setup_write_buffer(s))
+				return -1;
 		}
 
 	if (len == 0 && !create_empty_fragment)
