commit a5852a6db4b36f91d6254b2d8757f125e6e8e5cb
Author: Dr. Stephen Henson <steve@openssl.org>
Date:   Fri May 16 12:55:16 2014 +0100

    Additional CVE-2014-0224 protection.
    
    Return a fatal error if an attempt is made to use a zero length
    master secret.

Index: openssl-1.0.1f/ssl/s3_pkt.c
===================================================================
--- openssl-1.0.1f.orig/ssl/s3_pkt.c	2014-06-02 10:23:10.052618525 -0400
+++ openssl-1.0.1f/ssl/s3_pkt.c	2014-06-02 10:23:10.048618525 -0400
@@ -1444,7 +1444,7 @@
 
 	if (s->s3->tmp.key_block == NULL)
 		{
-		if (s->session == NULL) 
+		if (s->session == NULL || s->session->master_key_length == 0)
 			{
 			/* might happen if dtls1_read_bytes() calls this */
 			SSLerr(SSL_F_SSL3_DO_CHANGE_CIPHER_SPEC,SSL_R_CCS_RECEIVED_EARLY);
