From 0d4d2e02eb55f3a03e2a8e39b723b2a2ba436584 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Sat, 7 Jun 2014 15:21:13 +0100
Subject: [PATCH] Make tls_session_secret_cb work with CVE-2014-0224 fix.

If application uses tls_session_secret_cb for session resumption
set the CCS_OK flag.
(cherry picked from commit 953c592572e8811b7956cc09fbd8e98037068b58)
---
 ssl/s3_clnt.c |    1 +
 1 file changed, 1 insertion(+)

diff --git a/ssl/s3_clnt.c b/ssl/s3_clnt.c
index 0457af8..167bfc6 100644
--- a/ssl/s3_clnt.c
+++ b/ssl/s3_clnt.c
@@ -901,6 +901,7 @@ int ssl3_get_server_hello(SSL *s)
 			{
 			s->session->cipher = pref_cipher ?
 				pref_cipher : ssl_get_cipher_by_char(s, p+j);
+	    		s->s3->flags |= SSL3_FLAGS_CCS_OK;
 			}
 		}
 #endif /* OPENSSL_NO_TLSEXT */
-- 
1.7.9.5

