Description: fix denial of service via malformed ECParameters
Origin: based on patch by Andy Polyakov

Index: openssl-1.0.1f/crypto/bn/bn_gf2m.c
===================================================================
--- openssl-1.0.1f.orig/crypto/bn/bn_gf2m.c	2014-01-06 08:47:42.000000000 -0500
+++ openssl-1.0.1f/crypto/bn/bn_gf2m.c	2015-06-08 08:58:36.839146898 -0400
@@ -568,9 +568,10 @@
 		}
 #else
 	{
-	int i,	ubits = BN_num_bits(u),
-		vbits = BN_num_bits(v),	/* v is copy of p */
-		top = p->top;
+	int i;
+	int ubits = BN_num_bits(u);
+	int vbits = BN_num_bits(v); /* v is copy of p */
+	int top = p->top;
 	BN_ULONG *udp,*bdp,*vdp,*cdp;
 
 	bn_wexpand(u,top);	udp = u->d;
@@ -611,7 +612,12 @@
 			ubits--;
 			}
 
-		if (ubits<=BN_BITS2 && udp[0]==1) break;
+		if (ubits <= BN_BITS2) {
+			if (udp[0] == 0) /* poly was reducible */
+				goto err;
+			if (udp[0] == 1)
+				break;
+		}
 
 		if (ubits<vbits)
 			{
