From 106a9a5d7e26e728a654d7424849081bd988d4a5 Mon Sep 17 00:00:00 2001
From: Matt Caswell <matt@openssl.org>
Date: Wed, 10 Jun 2015 09:32:34 +0100
Subject: [PATCH] Fix Kerberos issue in ssl_session_dup

The fix for CVE-2015-1791 introduced an error in ssl_session_dup for
Kerberos.

Reviewed-by: Tim Hudson <tjh@openssl.org>
(cherry picked from commit dcad51bc13c9b716d9a66248bcc4038c071ff158)
---
 ssl/ssl_sess.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: openssl-1.0.1f/ssl/ssl_sess.c
===================================================================
--- openssl-1.0.1f.orig/ssl/ssl_sess.c	2015-06-10 07:09:16.773279092 -0400
+++ openssl-1.0.1f/ssl/ssl_sess.c	2015-06-10 07:09:47.489584122 -0400
@@ -239,7 +239,7 @@
 	memcpy(dest, src, sizeof(*dest));
 
 #ifndef OPENSSL_NO_KRB5
-	dest->krb5_client_princ_len = dest->krb5_client_princ_len;
+	dest->krb5_client_princ_len = src->krb5_client_princ_len;
 	if (src->krb5_client_princ_len > 0)
 		memcpy(dest->krb5_client_princ, src->krb5_client_princ,
 		       src->krb5_client_princ_len);
