Backport of:

From 2b4029e68fd7002d2307e6c3cde0f3784eef9c83 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Fri, 19 Aug 2016 23:28:29 +0100
Subject: [PATCH] Avoid overflow in MDC2_Update()

Thanks to Shi Lei for reporting this issue.

CVE-2016-6303

Reviewed-by: Matt Caswell <matt@openssl.org>
(cherry picked from commit 55d83bf7c10c7b205fffa23fa7c3977491e56c07)
---
 crypto/mdc2/mdc2dgst.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: openssl-1.0.1f/crypto/mdc2/mdc2dgst.c
===================================================================
--- openssl-1.0.1f.orig/crypto/mdc2/mdc2dgst.c	2016-09-22 09:39:40.554401091 -0400
+++ openssl-1.0.1f/crypto/mdc2/mdc2dgst.c	2016-09-22 09:40:05.542708564 -0400
@@ -92,7 +92,7 @@
 	i=c->num;
 	if (i != 0)
 		{
-		if (i+len < MDC2_BLOCK)
+		if (len < MDC2_BLOCK - i)
 			{
 			/* partial block */
 			memcpy(&(c->data[i]),in,len);
